version: '3.3'
services:
  server:
    image: node:16-alpine
    container_name: server
    command: sh -c "yarn install  && yarn build && yarn start"
    volumes:
      - ./:/server
    working_dir: /server
    ports:
      - '3080:3080'
    restart: 'always'
    networks:
      - postgres
  pgadmin:
    container_name: pgadmin_container
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: abeesdevjs@gmail.com
      PGADMIN_DEFAULT_PASSWORD: abees
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    volumes:
       - pgadmin:/var/lib/pgadmin

    ports:
      - "${PGADMIN_PORT:-5050}:80"

    logging:
      driver: "none"

    networks:
      - postgres
    restart: unless-stopped
  redis:
    image: 'redis:5.0.8-alpine'
    container_name: 'redis'
    ports:
      - 6379:6379
    healthcheck:
      test: ['CMD-SHELL', "sh -c 'redis-cli PING'"]
      interval: 30s
      timeout: 30s
      retries: 3
    restart: 'on-failure'
    networks: 
      - postgres
networks:
  postgres:
    driver: bridge
volumes:
  pgadmin:
